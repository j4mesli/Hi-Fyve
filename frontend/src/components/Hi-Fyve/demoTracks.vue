<template>
    <div class="top-artists-wrapper">
        <div class="artist-card" :class="{ 'open': index === 0, 'bottom': evaluateBottomWindow(index), 'top': index === 0 }" @click="e => closeHere(e)" v-for="(track, index) in (data as any[])" :key="track">
            <div class="body-paragraph" :class="{ 'closed': index > 0 }">
                <h2 class="title">#{{index + 1}}. {{ longName(track.name) }} <a target="_blank" :href="(data as any[])[index].external_urls.spotify"><span id="hyperlink" class="material-symbols-outlined">launch</span></a></h2>
                <h4>Artist(s): 
                    <span v-for="(artist, index) in track.artists" :key="artist" style="flex-direction: row">
                        <a target="_blank" :href="artist.external_urls.spotify">
                            {{ artist.name }}
                        </a>
                        <span v-if="index !== track.artists.length - 1" style="transform: translateY(0);">, </span>
                    </span>
                </h4>
                <h4 :class="{ 'hide-child-element': index > 0 }">Popularity: <span>{{ track.popularity }} / 100</span></h4>
                <h4 :class="{ 'hide-child-element': index > 0 }">Duration: <span>{{ convertMilliseconds(track.duration_ms) }}</span></h4>
                <h4 :class="{ 'hide-child-element': index > 0 }">Descriptors: 
                    <span class="track-attributes" v-for="(attribute, i) in track_attrs[index]" :key="attribute" style="flex-direction: row">
                        <span :style="'color:' + attribute[1]">{{attribute[0]}}</span>
                        <span v-if="i !== (track_attrs as Array<Array<string>>)[index].length - 1" style="transform: translateY(0);">, </span>
                    </span></h4>
            </div>
            <div class="pfp" :class="{ 'minimized': index > 0 }" :style="{ 'background-image': `url(${track.album.images[0].url})`, 'opacity': '0.9' }"></div>
        </div>
    </div>
</template>

<script lang="ts">
import { Ref, defineComponent, ref } from 'vue'
import { addCommasToNumber } from '../functions/addCommasToNumber';

export default defineComponent({
    setup() {
        const data = ref([
            {"album":{"album_type":"ALBUM","artists":[{"external_urls":{"spotify":"https://open.spotify.com/artist/4LLpKhyESsyAXpc4laK94U"},"href":"https://api.spotify.com/v1/artists/4LLpKhyESsyAXpc4laK94U","id":"4LLpKhyESsyAXpc4laK94U","name":"Mac Miller","type":"artist","uri":"spotify:artist:4LLpKhyESsyAXpc4laK94U"}],"available_markets":["AD","AE","AR","AT","AU","BE","BG","BH","BO","BR","CA","CH","CL","CO","CR","CY","CZ","DE","DK","DO","DZ","EC","EE","EG","ES","FI","FR","GB","GR","GT","HK","HN","HU","ID","IE","IL","IN","IS","IT","JO","JP","KW","LB","LI","LT","LU","LV","MA","MC","MT","MX","MY","NI","NL","NO","NZ","OM","PA","PE","PH","PL","PS","PT","PY","QA","RO","SA","SE","SG","SK","SV","TH","TN","TR","TW","US","UY","VN","ZA"],"external_urls":{"spotify":"https://open.spotify.com/album/2Tyx5dLhHYkx6zeAdVaTzN"},"href":"https://api.spotify.com/v1/albums/2Tyx5dLhHYkx6zeAdVaTzN","id":"2Tyx5dLhHYkx6zeAdVaTzN","images":[{"height":640,"url":"https://i.scdn.co/image/ab67616d0000b273ee0f38410382a255e4fb15f4","width":640},{"height":300,"url":"https://i.scdn.co/image/ab67616d00001e02ee0f38410382a255e4fb15f4","width":300},{"height":64,"url":"https://i.scdn.co/image/ab67616d00004851ee0f38410382a255e4fb15f4","width":64}],"name":"GO:OD AM","release_date":"2015-09-18","release_date_precision":"day","total_tracks":17,"type":"album","uri":"spotify:album:2Tyx5dLhHYkx6zeAdVaTzN"},"artists":[{"external_urls":{"spotify":"https://open.spotify.com/artist/4LLpKhyESsyAXpc4laK94U"},"href":"https://api.spotify.com/v1/artists/4LLpKhyESsyAXpc4laK94U","id":"4LLpKhyESsyAXpc4laK94U","name":"Mac Miller","type":"artist","uri":"spotify:artist:4LLpKhyESsyAXpc4laK94U"},{"external_urls":{"spotify":"https://open.spotify.com/artist/360IAlyVv4PCEVjgyMZrxK"},"href":"https://api.spotify.com/v1/artists/360IAlyVv4PCEVjgyMZrxK","id":"360IAlyVv4PCEVjgyMZrxK","name":"Miguel","type":"artist","uri":"spotify:artist:360IAlyVv4PCEVjgyMZrxK"}],"available_markets":["AD","AE","AR","AT","AU","BE","BG","BH","BO","BR","CA","CH","CL","CO","CR","CY","CZ","DE","DK","DO","DZ","EC","EE","EG","ES","FI","FR","GB","GR","GT","HK","HN","HU","ID","IE","IL","IN","IS","IT","JO","JP","KW","LB","LI","LT","LU","LV","MA","MC","MT","MX","MY","NI","NL","NO","NZ","OM","PA","PE","PH","PL","PS","PT","PY","QA","RO","SA","SE","SG","SK","SV","TH","TN","TR","TW","US","UY","VN","ZA"],"disc_number":1,"duration_ms":208080,"explicit":true,"external_ids":{"isrc":"USWB11508643"},"external_urls":{"spotify":"https://open.spotify.com/track/6GnhWMhgJb7uyiiPEiEkDA"},"href":"https://api.spotify.com/v1/tracks/6GnhWMhgJb7uyiiPEiEkDA","id":"6GnhWMhgJb7uyiiPEiEkDA","is_local":false,"name":"Weekend (feat. Miguel)","popularity":78,"preview_url":"https://p.scdn.co/mp3-preview/ba3e237fba3bebe7f1d615a96d15a46e7f6014c6?cid=770d4155707a433dbf4a20c9ed862cf8","track_number":7,"type":"track","uri":"spotify:track:6GnhWMhgJb7uyiiPEiEkDA"},
            {"album":{"album_type":"SINGLE","artists":[{"external_urls":{"spotify":"https://open.spotify.com/artist/7mvhRvEAHiCTQHUnH7fgnv"},"href":"https://api.spotify.com/v1/artists/7mvhRvEAHiCTQHUnH7fgnv","id":"7mvhRvEAHiCTQHUnH7fgnv","name":"キタニタツヤ","type":"artist","uri":"spotify:artist:7mvhRvEAHiCTQHUnH7fgnv"}],"available_markets":["AD","AE","AR","AT","AU","BE","BG","BH","BO","BR","CA","CH","CL","CO","CR","CY","CZ","DE","DK","DO","DZ","EC","EE","EG","ES","FI","FR","GB","GR","GT","HK","HN","HU","ID","IE","IL","IN","IS","IT","JO","JP","KW","LB","LI","LT","LU","LV","MA","MC","MT","MX","MY","NI","NL","NO","NZ","OM","PA","PE","PH","PL","PS","PT","PY","QA","RO","SA","SE","SG","SK","SV","TH","TN","TR","TW","US","UY","VN","ZA"],"external_urls":{"spotify":"https://open.spotify.com/album/4qHbR7z8zMoUFOukvg7KXd"},"href":"https://api.spotify.com/v1/albums/4qHbR7z8zMoUFOukvg7KXd","id":"4qHbR7z8zMoUFOukvg7KXd","images":[{"height":640,"url":"https://i.scdn.co/image/ab67616d0000b273c086023113fc322ffd962978","width":640},{"height":300,"url":"https://i.scdn.co/image/ab67616d00001e02c086023113fc322ffd962978","width":300},{"height":64,"url":"https://i.scdn.co/image/ab67616d00004851c086023113fc322ffd962978","width":64}],"name":"スカー","release_date":"2022-10-18","release_date_precision":"day","total_tracks":1,"type":"album","uri":"spotify:album:4qHbR7z8zMoUFOukvg7KXd"},"artists":[{"external_urls":{"spotify":"https://open.spotify.com/artist/7mvhRvEAHiCTQHUnH7fgnv"},"href":"https://api.spotify.com/v1/artists/7mvhRvEAHiCTQHUnH7fgnv","id":"7mvhRvEAHiCTQHUnH7fgnv","name":"キタニタツヤ","type":"artist","uri":"spotify:artist:7mvhRvEAHiCTQHUnH7fgnv"}],"available_markets":["AD","AE","AR","AT","AU","BE","BG","BH","BO","BR","CA","CH","CL","CO","CR","CY","CZ","DE","DK","DO","DZ","EC","EE","EG","ES","FI","FR","GB","GR","GT","HK","HN","HU","ID","IE","IL","IN","IS","IT","JO","JP","KW","LB","LI","LT","LU","LV","MA","MC","MT","MX","MY","NI","NL","NO","NZ","OM","PA","PE","PH","PL","PS","PT","PY","QA","RO","SA","SE","SG","SK","SV","TH","TN","TR","TW","US","UY","VN","ZA"],"disc_number":1,"duration_ms":259191,"explicit":false,"external_ids":{"isrc":"JPU902203471"},"external_urls":{"spotify":"https://open.spotify.com/track/5WQAussByRFjUWYQDowtHE"},"href":"https://api.spotify.com/v1/tracks/5WQAussByRFjUWYQDowtHE","id":"5WQAussByRFjUWYQDowtHE","is_local":false,"name":"スカー","popularity":67,"preview_url":"https://p.scdn.co/mp3-preview/17db57aa271a379b59c6dea23a4946db314afd5f?cid=770d4155707a433dbf4a20c9ed862cf8","track_number":1,"type":"track","uri":"spotify:track:5WQAussByRFjUWYQDowtHE"},
            {"album":{"album_type":"ALBUM","artists":[{"external_urls":{"spotify":"https://open.spotify.com/artist/70NcAr4ZtA3FAqU16iQZSb"},"href":"https://api.spotify.com/v1/artists/70NcAr4ZtA3FAqU16iQZSb","id":"70NcAr4ZtA3FAqU16iQZSb","name":"dhruv","type":"artist","uri":"spotify:artist:70NcAr4ZtA3FAqU16iQZSb"}],"available_markets":["AD","AE","AR","AT","AU","BE","BG","BH","BO","BR","CA","CH","CL","CO","CR","CY","CZ","DE","DK","DO","DZ","EC","EE","EG","ES","FI","FR","GB","GR","GT","HK","HN","HU","ID","IE","IL","IN","IS","IT","JO","JP","KW","LB","LI","LT","LU","LV","MA","MC","MT","MX","MY","NI","NL","NO","NZ","OM","PA","PE","PH","PL","PS","PT","PY","QA","RO","SA","SE","SG","SK","SV","TH","TN","TR","TW","US","UY","VN","ZA"],"external_urls":{"spotify":"https://open.spotify.com/album/305fd6KSKY40Yjgwvm2ck6"},"href":"https://api.spotify.com/v1/albums/305fd6KSKY40Yjgwvm2ck6","id":"305fd6KSKY40Yjgwvm2ck6","images":[{"height":640,"url":"https://i.scdn.co/image/ab67616d0000b2736f04e53cb5309f8e88286842","width":640},{"height":300,"url":"https://i.scdn.co/image/ab67616d00001e026f04e53cb5309f8e88286842","width":300},{"height":64,"url":"https://i.scdn.co/image/ab67616d000048516f04e53cb5309f8e88286842","width":64}],"name":"rapunzel","release_date":"2022-01-21","release_date_precision":"day","total_tracks":8,"type":"album","uri":"spotify:album:305fd6KSKY40Yjgwvm2ck6"},"artists":[{"external_urls":{"spotify":"https://open.spotify.com/artist/70NcAr4ZtA3FAqU16iQZSb"},"href":"https://api.spotify.com/v1/artists/70NcAr4ZtA3FAqU16iQZSb","id":"70NcAr4ZtA3FAqU16iQZSb","name":"dhruv","type":"artist","uri":"spotify:artist:70NcAr4ZtA3FAqU16iQZSb"}],"available_markets":["AD","AE","AR","AT","AU","BE","BG","BH","BO","BR","CA","CH","CL","CO","CR","CY","CZ","DE","DK","DO","DZ","EC","EE","EG","ES","FI","FR","GB","GR","GT","HK","HN","HU","ID","IE","IL","IN","IS","IT","JO","JP","KW","LB","LI","LT","LU","LV","MA","MC","MT","MX","MY","NI","NL","NO","NZ","OM","PA","PE","PH","PL","PS","PT","PY","QA","RO","SA","SE","SG","SK","SV","TH","TN","TR","TW","US","UY","VN","ZA"],"disc_number":1,"duration_ms":185375,"explicit":false,"external_ids":{"isrc":"USRC12103358"},"external_urls":{"spotify":"https://open.spotify.com/track/6sWkR0Y0NsJN4Ov3vKAPIa"},"href":"https://api.spotify.com/v1/tracks/6sWkR0Y0NsJN4Ov3vKAPIa","id":"6sWkR0Y0NsJN4Ov3vKAPIa","is_local":false,"name":"what's wrong with me?","popularity":47,"preview_url":"https://p.scdn.co/mp3-preview/a6f5b42e809df576c21efc70cf166a64e6887b8d?cid=770d4155707a433dbf4a20c9ed862cf8","track_number":6,"type":"track","uri":"spotify:track:6sWkR0Y0NsJN4Ov3vKAPIa"},
            {"album":{"album_type":"SINGLE","artists":[{"external_urls":{"spotify":"https://open.spotify.com/artist/1gWjcmBsveEYMxOZ0VRi32"},"href":"https://api.spotify.com/v1/artists/1gWjcmBsveEYMxOZ0VRi32","id":"1gWjcmBsveEYMxOZ0VRi32","name":"Koffee","type":"artist","uri":"spotify:artist:1gWjcmBsveEYMxOZ0VRi32"},{"external_urls":{"spotify":"https://open.spotify.com/artist/2hlmm7s2ICUX0LVIhVFlZQ"},"href":"https://api.spotify.com/v1/artists/2hlmm7s2ICUX0LVIhVFlZQ","id":"2hlmm7s2ICUX0LVIhVFlZQ","name":"Gunna","type":"artist","uri":"spotify:artist:2hlmm7s2ICUX0LVIhVFlZQ"}],"available_markets":["AD","AE","AR","AT","AU","BE","BG","BH","BO","BR","CA","CH","CL","CO","CR","CY","CZ","DE","DK","DO","DZ","EC","EE","EG","ES","FI","FR","GB","GR","GT","HK","HN","HU","ID","IE","IL","IN","IS","IT","JO","KW","LB","LI","LT","LU","LV","MA","MC","MT","MX","MY","NI","NL","NO","NZ","OM","PA","PE","PH","PL","PS","PT","PY","QA","RO","SA","SE","SG","SK","SV","TH","TN","TR","TW","US","UY","VN","ZA"],"external_urls":{"spotify":"https://open.spotify.com/album/4CGh0wfCdEh3xZVHx8uJK5"},"href":"https://api.spotify.com/v1/albums/4CGh0wfCdEh3xZVHx8uJK5","id":"4CGh0wfCdEh3xZVHx8uJK5","images":[{"height":640,"url":"https://i.scdn.co/image/ab67616d0000b27381459ae332fe629e46a4f182","width":640},{"height":300,"url":"https://i.scdn.co/image/ab67616d00001e0281459ae332fe629e46a4f182","width":300},{"height":64,"url":"https://i.scdn.co/image/ab67616d0000485181459ae332fe629e46a4f182","width":64}],"name":"W (feat. Gunna)","release_date":"2019-11-26","release_date_precision":"day","total_tracks":1,"type":"album","uri":"spotify:album:4CGh0wfCdEh3xZVHx8uJK5"},"artists":[{"external_urls":{"spotify":"https://open.spotify.com/artist/1gWjcmBsveEYMxOZ0VRi32"},"href":"https://api.spotify.com/v1/artists/1gWjcmBsveEYMxOZ0VRi32","id":"1gWjcmBsveEYMxOZ0VRi32","name":"Koffee","type":"artist","uri":"spotify:artist:1gWjcmBsveEYMxOZ0VRi32"},{"external_urls":{"spotify":"https://open.spotify.com/artist/2hlmm7s2ICUX0LVIhVFlZQ"},"href":"https://api.spotify.com/v1/artists/2hlmm7s2ICUX0LVIhVFlZQ","id":"2hlmm7s2ICUX0LVIhVFlZQ","name":"Gunna","type":"artist","uri":"spotify:artist:2hlmm7s2ICUX0LVIhVFlZQ"}],"available_markets":["AD","AE","AR","AT","AU","BE","BG","BH","BO","BR","CA","CH","CL","CO","CR","CY","CZ","DE","DK","DO","DZ","EC","EE","EG","ES","FI","FR","GB","GR","GT","HK","HN","HU","ID","IE","IL","IN","IS","IT","JO","KW","LB","LI","LT","LU","LV","MA","MC","MT","MX","MY","NI","NL","NO","NZ","OM","PA","PE","PH","PL","PS","PT","PY","QA","RO","SA","SE","SG","SK","SV","TH","TN","TR","TW","US","UY","VN","ZA"],"disc_number":1,"duration_ms":230151,"explicit":false,"external_ids":{"isrc":"GBARL1901308"},"external_urls":{"spotify":"https://open.spotify.com/track/6xW2g0c5uSoa3S6xk9eI4j"},"href":"https://api.spotify.com/v1/tracks/6xW2g0c5uSoa3S6xk9eI4j","id":"6xW2g0c5uSoa3S6xk9eI4j","is_local":false,"name":"W (feat. Gunna)","popularity":60,"preview_url":"https://p.scdn.co/mp3-preview/cc9c72e9d93ec4448a1e4896fa8ab624fd8d84fc?cid=770d4155707a433dbf4a20c9ed862cf8","track_number":1,"type":"track","uri":"spotify:track:6xW2g0c5uSoa3S6xk9eI4j"},
            {"album":{"album_type":"SINGLE","artists":[{"external_urls":{"spotify":"https://open.spotify.com/artist/4QvgGvpgzgyUOo8Yp8LDm9"},"href":"https://api.spotify.com/v1/artists/4QvgGvpgzgyUOo8Yp8LDm9","id":"4QvgGvpgzgyUOo8Yp8LDm9","name":"Mrs. GREEN APPLE","type":"artist","uri":"spotify:artist:4QvgGvpgzgyUOo8Yp8LDm9"}],"available_markets":["AD","AE","AR","AT","AU","BE","BG","BH","BO","BR","CA","CH","CL","CO","CR","CY","CZ","DE","DK","DO","DZ","EC","EE","EG","ES","FI","FR","GB","GR","GT","HK","HN","HU","ID","IE","IL","IN","IS","IT","JO","JP","KW","LB","LI","LT","LU","LV","MA","MC","MT","MX","MY","NI","NL","NO","NZ","OM","PA","PE","PH","PL","PS","PT","PY","QA","RO","SA","SE","SG","SK","SV","TH","TN","TR","TW","US","UY","VN","ZA"],"external_urls":{"spotify":"https://open.spotify.com/album/137FjNv5TRNvbW6D17bQc1"},"href":"https://api.spotify.com/v1/albums/137FjNv5TRNvbW6D17bQc1","id":"137FjNv5TRNvbW6D17bQc1","images":[{"height":640,"url":"https://i.scdn.co/image/ab67616d0000b2731a4e99f0c693fecc9038d3dd","width":640},{"height":300,"url":"https://i.scdn.co/image/ab67616d00001e021a4e99f0c693fecc9038d3dd","width":300},{"height":64,"url":"https://i.scdn.co/image/ab67616d000048511a4e99f0c693fecc9038d3dd","width":64}],"name":"インフェルノ","release_date":"2019-07-18","release_date_precision":"day","total_tracks":1,"type":"album","uri":"spotify:album:137FjNv5TRNvbW6D17bQc1"},"artists":[{"external_urls":{"spotify":"https://open.spotify.com/artist/4QvgGvpgzgyUOo8Yp8LDm9"},"href":"https://api.spotify.com/v1/artists/4QvgGvpgzgyUOo8Yp8LDm9","id":"4QvgGvpgzgyUOo8Yp8LDm9","name":"Mrs. GREEN APPLE","type":"artist","uri":"spotify:artist:4QvgGvpgzgyUOo8Yp8LDm9"}],"available_markets":["AD","AE","AR","AT","AU","BE","BG","BH","BO","BR","CA","CH","CL","CO","CR","CY","CZ","DE","DK","DO","DZ","EC","EE","EG","ES","FI","FR","GB","GR","GT","HK","HN","HU","ID","IE","IL","IN","IS","IT","JO","JP","KW","LB","LI","LT","LU","LV","MA","MC","MT","MX","MY","NI","NL","NO","NZ","OM","PA","PE","PH","PL","PS","PT","PY","QA","RO","SA","SE","SG","SK","SV","TH","TN","TR","TW","US","UY","VN","ZA"],"disc_number":1,"duration_ms":212546,"explicit":false,"external_ids":{"isrc":"JPPO01902850"},"external_urls":{"spotify":"https://open.spotify.com/track/64yajM6CxtLghmgB53VeXT"},"href":"https://api.spotify.com/v1/tracks/64yajM6CxtLghmgB53VeXT","id":"64yajM6CxtLghmgB53VeXT","is_local":false,"name":"インフェルノ","popularity":69,"preview_url":"https://p.scdn.co/mp3-preview/e6da6e26559fd35c16f4084d8aa77eaf7de24914?cid=770d4155707a433dbf4a20c9ed862cf8","track_number":1,"type":"track","uri":"spotify:track:64yajM6CxtLghmgB53VeXT"},
        ]) as Ref<unknown[]>;
        const track_attrs = ref([
        [["Cadenced","rgb(185,232,246)"],["Relaxed","rgb(102,192,217)"],["Vibrant","rgb(250, 234, 110)"],["Melancholic","rgb(102,192,217)"]],
            [["Envigorating","rgb(250, 234, 110)"],["Danceable","rgb(102,192,217)"],["Stirring","rgb(252,132,141)"]],
            [["Acoustic","rgb(252,144,56)"],["Relaxed","rgb(102,192,217)"],["Upbeat","rgb(252,132,141)"],["Melancholic","rgb(102,192,217)"]],
            [["Dynamic","rgb(203,176,235)"],["Vibrant","rgb(250, 234, 110)"],["Radiant","rgb(250, 234, 110)"]],
            [["Animated","rgb(185,232,246)"],["Upbeat","rgb(252,132,141)"],["Upbeat","rgb(203,176,235)"]],
        ]) as Ref<unknown[]>;

        const addCommas = (x: string | number) => {
            return typeof x === 'string' ? addCommasToNumber(parseInt(x)) : addCommasToNumber(x);
        };
        const evaluateBottomWindow = (num: number) => {
            return num+1 === data.value.length;
        };
        const convertMilliseconds = (num: number) => {
            const date = new Date(num);
            return date.getMinutes() + ' min, ' + date.getSeconds() + ' sec'
        };
        const longName = (name: string) => {
            return name.length > 23 ? name.slice(0,21) + '...' : name;
        };
        const closeHere = (e: MouseEvent) => {
            // CURRENTTARGET ONLY TARGETS THE ELEM WITH LISTENER
            if ((e.target as Element).id !== 'hyperlink') {
                const elem: Element = e.currentTarget as Element;
                if (elem.classList.contains('open')) {
                    elem.children[1].classList.toggle('minimized');
                    for (let i = 2; i < elem.children[0].children.length; i++) {
                        elem.children[0].children[i].classList.toggle('hide-child-element');
                        elem.children[0].classList.toggle('closed');
                    }
                }
                else {
                    setTimeout(() => {
                        elem.children[1].classList.toggle('minimized');
                        for (let i = 2; i < elem.children[0].children.length; i++) {
                            elem.children[0].children[i].classList.toggle('hide-child-element');
                            elem.children[0].classList.toggle('closed');
                        }
                    }, 300);
                }
                elem.classList.toggle('open');
            }
        }

        return { addCommas, evaluateBottomWindow, convertMilliseconds, longName, track_attrs, data, closeHere };
    },
})
</script>

<style>

</style>